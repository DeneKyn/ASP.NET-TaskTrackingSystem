@{
    ViewData["Title"] = "Home Page";
}

@if (User.Identity.IsAuthenticated)
{
    <div id="inputForm">
        <input hidden id="UserName" type="text" value="@User.Identity.Name">
        <input type="text" id="message" />
        <input type="button" id="sendBtn" value="Отправить" />
    </div>
    <div id="chatroom"></div>
}
    <script src="~/lib/signalr/signalr.min.js"></script>
    <script>
        window.onload = () => {
            let hubUrl = 'https://localhost:44306/chat';
            const hubConnection = new signalR.HubConnectionBuilder()
                .withUrl(hubUrl)
                .configureLogging(signalR.LogLevel.Information)
                .build();
            let userName = ''
            hubConnection.on("Send", function (message, userName) {

                let userNameElem = document.createElement("b");
                userNameElem.appendChild(document.createTextNode(userName + ': '));

                let elem = document.createElement("p");
                elem.appendChild(userNameElem);
                elem.appendChild(document.createTextNode(message));

                var firstElem = document.getElementById("chatroom").firstChild;
                document.getElementById("chatroom").insertBefore(elem, firstElem);

            });

            document.getElementById("sendBtn").addEventListener("click", function (e) {
                let message = document.getElementById("message").value;
                var user = document.getElementById("UserName").value;
                hubConnection.invoke("Send", message, user);
            });

            hubConnection.start();
        };
    </script>
